<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Credit Report Comparison Workflow Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ... (existing styles) ... */
        body {
            font-family: 'Inter', sans-serif;
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #c4b5fd;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a78bfa;
        }
        .active-nav-link {
            background-color: #e9d5ff;
            color: #5b21b6;
            font-weight: 600;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px; /* Adjusted for better visibility */
            max-height: 50vh;
        }
        @media (min-width: 768px) { .chart-container { height: 450px; } }
        @media (min-width: 1024px) { .chart-container { height: 500px; } }

        pre { /* ... existing pre styles ... */ }
        code { /* ... existing code styles ... */ }
        table { /* ... existing table styles ... */ }
        th, td { /* ... existing th, td styles ... */ }
        th { /* ... existing th styles ... */ }
        h1, h2, h3, h4 { scroll-margin-top: 4.5rem; }
        .gemini-button { /* ... existing gemini-button styles ... */ }
        .gemini-button:hover { /* ... existing gemini-button:hover styles ... */ }
        .gemini-result-area { /* ... existing gemini-result-area styles ... */ }

        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.25rem; font-weight: 500; color: #4b5563; }
        .input-group input[type="number"], .input-group select, .input-group input[type="range"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .input-group input[type="range"] { padding: 0; }
        .input-group .range-value { font-weight: bold; color: #6d28d9; margin-left: 0.5rem; }

        #interactiveControls {
            background-color: #fffbeb; /* Light amber */
            border: 1px solid #fde68a; /* Amber-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        #interactiveControls h3 {
            color: #6d28d9; /* Purple-700 */
            border-bottom: 2px solid #c4b5fd; /* Purple-300 */
            padding-bottom: 0.5rem;
        }
    </style>
</head>
<body class="bg-amber-50 text-stone-800">

    <aside id="sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen transition-transform -translate-x-full sm:translate-x-0 bg-amber-100 border-r border-amber-200 shadow-lg overflow-y-auto">
        <div class="p-5">
            <h2 class="text-2xl font-semibold text-purple-700 mb-6">Workflow Sections</h2>
            <nav id="TableOfContents" class="space-y-2">
                <a href="#interactiveControlsSection" class="block px-3 py-2 rounded-md text-stone-700 hover:bg-amber-200 hover:text-purple-600 transition-colors duration-150">0. Interactive Controls</a>
                <a href="#section1" class="block px-3 py-2 rounded-md text-stone-700 hover:bg-amber-200 hover:text-purple-600 transition-colors duration-150">I. Introduction</a>
                <a href="#section6" class="block px-3 py-2 rounded-md text-stone-700 hover:bg-amber-200 hover:text-purple-600 transition-colors duration-150">VI. Comparative Analysis</a>
                </nav>
        </div>
    </aside>

    <button id="mobileNavToggle" data-drawer-target="sidebar" data-drawer-toggle="sidebar" aria-controls="sidebar" type="button" class="sm:hidden fixed top-4 left-4 z-50 inline-flex items-center p-2 text-sm text-purple-600 bg-amber-200 rounded-lg hover:bg-amber-300 focus:outline-none focus:ring-2 focus:ring-amber-300">
        </button>

    <main class="sm:ml-64 p-6 md:p-10 bg-amber-50 min-h-screen">
        <header class="mb-10 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-purple-800 leading-tight">
                Interactive Comparative Workflow for Simulated LLM and Expert Credit Reports
            </h1>
        </header>

        <article class="prose prose-lg max-w-none prose-headings:text-purple-700 prose-a:text-emerald-600 hover:prose-a:text-emerald-700 prose-strong:text-purple-600 prose-code:bg-amber-100 prose-code:text-purple-700 prose-code:p-1 prose-code:rounded-md prose-pre:bg-stone-100 prose-pre:text-stone-800">

            <section id="interactiveControlsSection" class="mb-12 p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-semibold mb-4 border-b-2 border-amber-300 pb-2">0. Interactive Controls & Assumptions (OpenAI May 2025 - Simulated)</h2>
                <p class="mb-4">Adjust the parameters below to simulate different scenarios for OpenAI and observe their hypothetical impact on the credit report comparison. Changes will update the table and chart in Section VI.</p>

                <div id="interactiveControls" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="input-group">
                        <label for="revenueAssumption">Projected Annual Revenue (USD Billions): <span id="revenueAssumptionValue" class="range-value">3</span></label>
                        <input type="range" id="revenueAssumption" name="revenueAssumption" min="1" max="20" value="3" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="rdSpendAssumption">Projected R&D Spend (USD Billions): <span id="rdSpendAssumptionValue" class="range-value">5</span></label>
                        <input type="range" id="rdSpendAssumption" name="rdSpendAssumption" min="1" max="15" value="5" step="0.5">
                    </div>
                    <div class="input-group">
                        <label for="marketCompLevel">Market Competitiveness Level (1=Low, 10=High): <span id="marketCompLevelValue" class="range-value">7</span></label>
                        <input type="range" id="marketCompLevel" name="marketCompLevel" min="1" max="10" value="7" step="1">
                    </div>
                     <div class="input-group">
                        <label for="regScrutinyLevel">Regulatory Scrutiny Level (1=Low, 10=High): <span id="regScrutinyLevelValue" class="range-value">6</span></label>
                        <input type="range" id="regScrutinyLevel" name="regScrutinyLevel" min="1" max="10" value="6" step="1">
                    </div>
                    <div class="input-group">
                        <label for="llmOptimism">LLM Report Optimism (1=Pessimistic, 5=Neutral, 10=Very Optimistic): <span id="llmOptimismValue" class="range-value">7</span></label>
                        <input type="range" id="llmOptimism" name="llmOptimism" min="1" max="10" value="7" step="1">
                    </div>
                    <div class="input-group">
                        <label for="expertCriticality">Expert Report Criticality (1=Lenient, 5=Neutral, 10=Very Critical): <span id="expertCriticalityValue" class="range-value">7</span></label>
                        <input type="range" id="expertCriticality" name="expertCriticality" min="1" max="10" value="7" step="1">
                    </div>
                </div>
                <p class="mt-4 text-sm text-stone-600">Note: These controls trigger simplified, illustrative changes to the scores. They do not re-run complex NLP models but simulate potential impacts.</p>
            </section>

            <section id="section1" class="mb-12 p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-semibold mb-4 border-b-2 border-amber-300 pb-2">I. Introduction: Setting the Stage for Advanced Credit Report Simulation</h2>
                <p>...</p>
            </section>

             <section id="section3" class="mb-12 p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-semibold mb-4 border-b-2 border-amber-300 pb-2">III. Simulating an LLM-Generated Credit Report for OpenAI (May 2025)</h2>
                <h3 class="text-2xl font-medium mt-6 mb-3">C. Structuring the Simulated LLM Report Data</h3>
                <p>The report should cover Executive Summary, Company Profile, Financial Overview, Market Position & Competitive Landscape, Risk Factors, and Outlook, with content styled to mimic LLM output.</p>
                <p><strong>Example Content Snippets (Dynamic based on Optimism):</strong></p>
                <ul id="llmSnippetsDisplay" class="list-disc list-inside space-y-1 pl-4">
                    </ul>
                <button id="expertTakeOnLLMSnippetsButton" class="gemini-button">✨ Get Expert Take on these LLM Snippets</button>
                <div id="expertTakeOnLLMSnippetsResult" class="gemini-result-area hidden"></div>
                 </section>

             <section id="section4" class="mb-12 p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-semibold mb-4 border-b-2 border-amber-300 pb-2">IV. Simulating an Expert Credit Report for OpenAI (May 2025)</h2>
                <h3 class="text-2xl font-medium mt-6 mb-3">C. Structuring the Simulated Expert Report Data</h3>
                <p>Similar sections to the LLM report but with deeper, more critical content. Example for Financial Analysis (Dynamic based on R&D/Revenue and Criticality):</p>
                <p id="expertFinancialAnalysisSnippet">
                    </p>
                <button id="counterargumentsToExpertViewButton" class="gemini-button">✨ Suggest Counterarguments to Expert View</button>
                <div id="counterargumentsToExpertViewResult" class="gemini-result-area hidden"></div>
                </section>

            <section id="section6" class="mb-12 p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-semibold mb-4 border-b-2 border-amber-300 pb-2">VI. Generating the Comparative Analysis Table</h2>
                 <h3 class="text-2xl font-medium mt-6 mb-3">D. Must-have Table: Comparative Analysis of Simulated OpenAI Credit Reports (May 2025)</h3>
                <p class="mb-4">The following table presents an illustrative comparison, dynamically updated by the controls above. Qualitative scores can be edited directly in the table.</p>
                <div class="overflow-x-auto">
                    <table id="comparisonTable">
                        <thead>
                            <tr>
                                <th>Criterion/Metric</th>
                                <th>LLM Simulated Report (Score/Finding)</th>
                                <th>Expert Simulated Report (Score/Finding)</th>
                                <th>Difference/Delta</th>
                                </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
                <p class="mt-6 mb-3 text-xl font-semibold text-purple-700">Interactive Visualization of Comparative Scores:</p>
                <p class="mb-4">This chart visually represents the scores from the table above. Hover over the bars to see the specific scores. Updates dynamically.</p>
                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>
            </section>

            </article>
         <footer class="mt-12 pt-8 border-t border-amber-300 text-center text-stone-600">
            <p>&copy; 2025 Interactive Credit Report Workflow Analyzer. For illustrative purposes.</p>
        </footer>
    </main>

    <script>
        // Sidebar toggle (existing)
        // Smooth scroll and active link highlighting (existing, ensure #interactiveControlsSection is handled)

        let comparisonChartInstance; // To hold the chart instance for updates

        // Initial data for the comparison table and chart
        // Values are [LLM, Expert]
        // Indices for data: 0:Clarity, 1:Depth, 2:RiskID, 3:Actionability, 4:Specificity, 5:Balance,
        // 6:Polarity, 7:Subjectivity, 8:Readability, 9:RiskDensity, 10:NumFigures, 11:AvgSentenceLength
        let baselineScores = {
            qualitative: [
                { name: 'Clarity & Coherence', llm: 4, expert: 5, notes: "Expert report potentially more direct." },
                { name: 'Depth of Analysis', llm: 2, expert: 4, notes: "Expert report likely more critical." },
                { name: 'Identification & Articulation of Key Risks', llm: 3, expert: 5, notes: "Expert details more specific risks." },
                { name: 'Actionability/Insightfulness', llm: 2, expert: 4, notes: "Expert insights more pointed." },
                { name: 'Specificity to OpenAI', llm: 3, expert: 5, notes: "Expert report more tailored." },
                { name: 'Balanced Perspective', llm: 4, expert: 4, notes: "Both aim for balance." }
            ],
            quantitative: [
                { name: 'Overall Sentiment: Polarity', llm: 0.15, expert: 0.05, notes: "LLM report may be slightly more positive.", type: 'float' },
                { name: 'Overall Sentiment: Subjectivity', llm: 0.40, expert: 0.60, notes: "Expert report more opinionated.", type: 'float' },
                { name: 'Readability: Flesch Reading Ease', llm: 55, expert: 40, notes: "LLM report potentially easier to read.", type: 'integer' },
                { name: 'Density: "Risk" keywords (per 1k words)', llm: 5.2, expert: 9.5, notes: "Expert report higher risk term density.", type: 'float' },
                { name: 'Count: Numerical Figures', llm: 12, expert: 25, notes: "Expert report more data points.", type: 'integer' },
                { name: 'Avg. Sentence Length (words)', llm: 18, expert: 22, notes: "Expert report longer sentences.", type: 'integer' }
            ]
        };

        let currentScores = JSON.parse(JSON.stringify(baselineScores)); // Deep copy

        function updateRangeValue(sliderId, displayId) {
            const slider = document.getElementById(sliderId);
            const display = document.getElementById(displayId);
            if (slider && display) {
                display.textContent = slider.value;
                slider.addEventListener('input', () => {
                    display.textContent = slider.value;
                    recalculateAndRender();
                });
            }
        }

        function generateLLMSnippets(optimism) {
            // Optimism: 1 (low) to 10 (high)
            let revenueSnippet, riskSnippet;
            if (optimism <= 3) {
                revenueSnippet = "Revenue growth faces significant headwinds due to market saturation and competitive pressures on API pricing.";
                riskSnippet = "The evolving global regulatory framework poses substantial and immediate threats. Compliance challenges are mounting, and societal concerns could severely impact adoption.";
            } else if (optimism <= 7) {
                revenueSnippet = "The company has demonstrated steady revenue growth, primarily driven by the adoption of its API services and enterprise solutions, though future growth may moderate.";
                riskSnippet = "The evolving global regulatory framework for artificial intelligence presents uncertainties. Compliance with data privacy regulations and addressing societal concerns are important areas of focus.";
            } else {
                revenueSnippet = "The company is experiencing explosive revenue growth, fueled by groundbreaking API services and rapid expansion into new enterprise verticals, showing strong upward momentum.";
                riskSnippet = "While the regulatory landscape for AI is still developing, OpenAI is proactively shaping standards and addressing societal concerns, turning potential risks into opportunities for leadership.";
            }
            return `<li><strong>Financial Overview (Revenue):</strong> ${revenueSnippet}</li>
                    <li><strong>Risk Factors (Regulatory):</strong> ${riskSnippet}</li>`;
        }

        function generateExpertFinancialAnalysis(revenue, rdSpend, criticality) {
            // criticality: 1 (low) to 10 (high)
            const rdToRevenueRatio = rdSpend / revenue;
            let analysis = `OpenAI's financial position as of May 2025 shows projected revenues of $${revenue}B and R&D expenditures of $${rdSpend}B. `;

            if (rdToRevenueRatio > 1.5) { // High R&D relative to revenue
                analysis += `The aggressive R&D spend, at ${((rdToRevenueRatio) * 100).toFixed(0)}% of revenue, significantly outpaces direct revenue conversion. `;
                if (criticality > 7) {
                    analysis += "This strategy, while aimed at technological dominance, presents a material near-term profitability challenge and heightens reliance on external funding. Cash burn rates require very close monitoring. ";
                } else if (criticality > 4) {
                    analysis += "This indicates a continued investment phase, which, while common for growth-focused tech, does introduce financial pressure that warrants observation. ";
                } else {
                    analysis += "This level of investment is bold and positions them for future breakthroughs, assuming funding remains available. ";
                }
            } else {
                analysis += `R&D spending is substantial but more aligned with current revenue streams. `;
                 if (criticality > 6) {
                    analysis += "Focus should remain on ensuring these investments translate to sustainable margin improvements and market share gains against increasingly capable competitors. ";
                } else {
                     analysis += "This balanced approach allows for innovation while managing financial exposure. ";
                 }
            }
            analysis += `The company's gross margins are impacted by high compute costs. With market competitiveness at ${document.getElementById('marketCompLevel').value}/10 and regulatory scrutiny at ${document.getElementById('regScrutinyLevel').value}/10, the path to sustained high profitability involves navigating these external pressures effectively.`
            return analysis;
        }


        function recalculateAndRender() {
            const revenue = parseFloat(document.getElementById('revenueAssumption').value);
            const rdSpend = parseFloat(document.getElementById('rdSpendAssumption').value);
            const marketComp = parseInt(document.getElementById('marketCompLevel').value);
            const regScrutiny = parseInt(document.getElementById('regScrutinyLevel').value);
            const llmOptimism = parseInt(document.getElementById('llmOptimism').value); // 1-10
            const expertCriticality = parseInt(document.getElementById('expertCriticality').value); // 1-10

            // Simulate impact on scores (these are illustrative, not based on real NLP)
            currentScores = JSON.parse(JSON.stringify(baselineScores)); // Reset to baseline then adjust

            // LLM Report Adjustments
            // Polarity: higher optimism -> more positive. Scale 1-10 to -0.5 to 0.5
            currentScores.quantitative[0].llm = (llmOptimism - 5.5) / 10;
            // Readability: higher optimism might mean simpler, more positive language (higher score)
            currentScores.quantitative[2].llm = baselineScores.quantitative[2].llm + (llmOptimism - 5) * 2;
             // Numerical Figures: less detail if overly optimistic/simplistic
            currentScores.quantitative[4].llm = baselineScores.quantitative[4].llm - (llmOptimism > 7 ? (llmOptimism-7) : 0);


            // Expert Report Adjustments
            // Polarity: higher criticality -> more negative
            currentScores.quantitative[0].expert = baselineScores.quantitative[0].expert - (expertCriticality - 5) * 0.03;
            // Subjectivity: higher criticality -> more opinionated
            currentScores.quantitative[1].expert = baselineScores.quantitative[1].expert + (expertCriticality - 5) * 0.04;
            // Risk Density: higher regScrutiny/marketComp/criticality -> higher risk density
            currentScores.quantitative[3].expert = baselineScores.quantitative[3].expert + (regScrutiny - 6) * 0.3 + (marketComp - 7) * 0.2 + (expertCriticality - 5) * 0.2;
            // Numerical Figures: higher revenue/RD -> more figures to discuss
            currentScores.quantitative[4].expert = baselineScores.quantitative[4].expert + (revenue - 3) * 1 + (rdSpend - 5) * 0.5;
             // Depth of Analysis (Qualitative) linked to criticality
            currentScores.qualitative[1].expert = Math.min(5, baselineScores.qualitative[1].expert + (expertCriticality - 7) * 0.25 + (regScrutiny > 7 ? 0.5 : 0) );
            currentScores.qualitative[1].llm = Math.max(1, baselineScores.qualitative[1].llm + (llmOptimism - 7) * 0.1 - (regScrutiny > 7 ? 0.5 : 0));


            // Cap scores to plausible ranges
            currentScores.quantitative.forEach(metric => {
                if (metric.name.includes("Polarity")) {
                    metric.llm = Math.max(-1, Math.min(1, metric.llm));
                    metric.expert = Math.max(-1, Math.min(1, metric.expert));
                }
                if (metric.name.includes("Subjectivity")) {
                    metric.llm = Math.max(0, Math.min(1, metric.llm));
                    metric.expert = Math.max(0, Math.min(1, metric.expert));
                }
                if (metric.name.includes("Readability")) {
                    metric.llm = Math.max(0, Math.min(100, metric.llm));
                    metric.expert = Math.max(0, Math.min(100, metric.expert));
                }
                 if (metric.name.includes("Density") || metric.name.includes("Count") || metric.name.includes("Length")) {
                    metric.llm = Math.max(0, metric.llm);
                    metric.expert = Math.max(0, metric.expert);
                }
            });
            currentScores.qualitative.forEach(metric => {
                 metric.llm = Math.round(Math.max(1, Math.min(5, metric.llm)));
                 metric.expert = Math.round(Math.max(1, Math.min(5, metric.expert)));
            });


            populateTable();
            updateChart();
            updateDynamicContent(llmOptimism, revenue, rdSpend, expertCriticality);
        }
        
        function updateDynamicContent(llmOptimism, revenue, rdSpend, expertCriticality) {
            const llmSnippetsEl = document.getElementById('llmSnippetsDisplay');
            if (llmSnippetsEl) {
                llmSnippetsEl.innerHTML = generateLLMSnippets(llmOptimism);
            }

            const expertFinancialEl = document.getElementById('expertFinancialAnalysisSnippet');
            if (expertFinancialEl) {
                expertFinancialEl.innerHTML = generateExpertFinancialAnalysis(revenue, rdSpend, expertCriticality);
            }
        }


        function populateTable() {
            const tableBody = document.querySelector("#comparisonTable tbody");
            tableBody.innerHTML = ''; // Clear existing rows

            let sectionHeaderQualitative = `<tr class="bg-amber-100"><td colspan="4" class="font-bold">Qualitative Assessment (1-5 Scale, Editable)</td></tr>`;
            tableBody.insertAdjacentHTML('beforeend', sectionHeaderQualitative);

            currentScores.qualitative.forEach((metric, index) => {
                const row = `<tr>
                    <td>${metric.name}</td>
                    <td><input type="number" min="1" max="5" value="${metric.llm}" class="score-input w-20 p-1 border rounded" data-type="qualitative" data-report="llm" data-index="${index}"></td>
                    <td><input type="number" min="1" max="5" value="${metric.expert}" class="score-input w-20 p-1 border rounded" data-type="qualitative" data-report="expert" data-index="${index}"></td>
                    <td>${(metric.llm - metric.expert).toFixed(0)}</td>
                </tr>`;
                tableBody.insertAdjacentHTML('beforeend', row);
            });

            let sectionHeaderQuantitative = `<tr class="bg-amber-100"><td colspan="4" class="font-bold">Quantitative Metrics (Simulated)</td></tr>`;
            tableBody.insertAdjacentHTML('beforeend', sectionHeaderQuantitative);

            currentScores.quantitative.forEach(metric => {
                const llmVal = metric.type === 'float' ? metric.llm.toFixed(2) : metric.llm.toFixed(0);
                const expVal = metric.type === 'float' ? metric.expert.toFixed(2) : metric.expert.toFixed(0);
                const diff = metric.type === 'float' ? (metric.llm - metric.expert).toFixed(2) : (metric.llm - metric.expert).toFixed(0);
                const row = `<tr>
                    <td>${metric.name}</td>
                    <td>${llmVal}</td>
                    <td>${expVal}</td>
                    <td>${diff}</td>
                </tr>`;
                tableBody.insertAdjacentHTML('beforeend', row);
            });

            // Add event listeners for new input fields in table
            document.querySelectorAll('.score-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const type = e.target.dataset.type;
                    const report = e.target.dataset.report;
                    const index = parseInt(e.target.dataset.index);
                    const value = parseInt(e.target.value);

                    if (type === 'qualitative') {
                        currentScores.qualitative[index][report] = value;
                    }
                    // Could add quantitative direct edit here if desired
                    populateTable(); // Re-render to update delta
                    updateChart();
                });
            });
        }

        function updateChart() {
            const llmData = [
                ...currentScores.qualitative.map(s => s.llm),
                ...currentScores.quantitative.map(s => s.llm)
            ];
            const expertData = [
                ...currentScores.qualitative.map(s => s.expert),
                ...currentScores.quantitative.map(s => s.expert)
            ];

            if (comparisonChartInstance) {
                comparisonChartInstance.data.datasets[0].data = llmData;
                comparisonChartInstance.data.datasets[1].data = expertData;
                comparisonChartInstance.update();
            }
        }
        
        function createChart() {
            const ctx = document.getElementById('comparisonChart');
            if (!ctx) return;

            const chartLabels = [
                ...baselineScores.qualitative.map(s => s.name.replace('Actionability/Insightfulness', 'Actionability').replace('Identification & Articulation of Key Risks', 'Risk ID')),
                ...baselineScores.quantitative.map(s => s.name.replace('Overall Sentiment: Polarity', 'Polarity').replace('Overall Sentiment: Subjectivity', 'Subjectivity').replace('Readability: Flesch Reading Ease', 'Readability (Flesch)').replace('Density: "Risk" keywords (per 1k words)', 'Risk KWs').replace('Count: Numerical Figures', 'Num. Figs').replace('Avg. Sentence Length (words)', 'Avg. Sent. Len.'))
            ];
            
            const initialLlmData = [ ...currentScores.qualitative.map(s => s.llm), ...currentScores.quantitative.map(s => s.llm) ];
            const initialExpertData = [ ...currentScores.qualitative.map(s => s.expert), ...currentScores.quantitative.map(s => s.expert) ];


            const tooltipCallback = (context) => { /* ... (existing tooltip callback) ... */ };
            const wrapLabels = (labels, maxWidth) => { /* ... (existing wrapLabels function) ... */ };

            comparisonChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: wrapLabels(chartLabels, 12), // Shorter wrap for more labels
                    datasets: [
                        {
                            label: 'LLM Simulated Report',
                            data: initialLlmData,
                            backgroundColor: 'rgba(167, 139, 250, 0.6)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 1, borderRadius: 5,
                        },
                        {
                            label: 'Expert Simulated Report',
                            data: initialExpertData,
                            backgroundColor: 'rgba(52, 211, 153, 0.6)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1, borderRadius: 5,
                        }
                    ]
                },
                options: { /* ... (existing chart options, ensure y-axis can handle floats and integers) ... */
                    responsive: true, maintainAspectRatio: false,
                     scales: {
                        y: {
                            beginAtZero: true, // Adjust if sentiment polarity needs to go negative
                            title: { display: true, text: 'Score / Value', font: { size: 14, weight: 'bold' }, color: '#4b5563' },
                            ticks: { color: '#4b5563', callback: function(value, index, values) { return Number.isInteger(value) || (Math.abs(value) < 2 && value !==0) ? value : null; }} // Show ticks for integers and small floats
                        },
                        x: {
                            title: { display: true, text: 'Comparison Metrics', font: { size: 14, weight: 'bold' }, color: '#4b5563' },
                            ticks: { color: '#4b5563', maxRotation: 60, minRotation: 45, autoSkip: false, font: {size: 10} } // adjust font size
                        }
                    },
                     plugins: {
                        legend: { position: 'top', labels: { font: { size: 12 }, color: '#374151' }},
                        tooltip: {
                            mode: 'index', intersect: false, callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed.y !== null) {
                                        const metricName = context.chart.data.labels[context.dataIndex];
                                        // Qualitative scores are 1-5
                                        if (['Clarity & Coherence', 'Depth of Analysis', 'Risk ID', 'Actionability', 'Specificity', 'Balanced Perspective'].some(qMetric => metricName.includes(qMetric))) {
                                            label += context.parsed.y.toFixed(0) + ' / 5';
                                        } else if (metricName.includes('Polarity') || metricName.includes('Subjectivity') || metricName.includes('Risk KWs') ) {
                                            label += context.parsed.y.toFixed(2);
                                        } else { // Readability, Num. Figs, Avg. Sent. Len.
                                            label += context.parsed.y.toFixed(0);
                                        }
                                    }
                                    return label;
                                }
                            },
                            titleFont: { size: 14 }, bodyFont: { size: 12 },
                            backgroundColor: 'rgba(0,0,0,0.7)', titleColor: '#ffffff', bodyColor: '#ffffff',
                            padding: 10, cornerRadius: 4
                        }
                    },
                    animation: { duration: 500, easing: 'easeInOutQuart' } // Faster animation
                }
            });
        }

        // SIMULATED Gemini API call
        async function callSimulatedGeminiApi(promptGenerator, resultElementId, loadingText) {
            const resultDiv = document.getElementById(resultElementId);
            if (!resultDiv) return;

            resultDiv.innerHTML = `<p class="text-center text-purple-600 animate-pulse p-4">${loadingText || '✨ Thinking...'}</p>`;
            resultDiv.classList.remove('hidden');

            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 750));
            
            const generatedText = promptGenerator(); // Get text from the specific generator

            // Basic formatting for display
            let htmlText = generatedText
                .replace(/\n\*(.*?)\n/g, '</ul><ul class="list-disc list-inside space-y-1 pl-4 mt-2 text-stone-700"><li>$1</li>') // Handle multiple lists
                .replace(/^\*(.*?)\n/gm, '<li>$1</li>') // Initial bullet
                .replace(/\n\s*-\s(.*?)(?=\n\s*-\s|\n*$)/g, '<li>$1</li>') // Handle hyphens as bullets
                .replace(/\n/g, '<br>');
            
            if (htmlText.startsWith('<li>') || htmlText.includes('<ul>')) {
                 if (!htmlText.startsWith('<ul>')) htmlText = '<ul class="list-disc list-inside space-y-1 pl-4 mt-2 text-stone-700">' + htmlText;
                 if (!htmlText.endsWith('</ul>')) htmlText += '</ul>';
            } else {
                 htmlText = `<p class="mt-2 text-stone-700">${htmlText}</p>`;
            }

            resultDiv.innerHTML = htmlText;
        }


        document.addEventListener('DOMContentLoaded', () => {
            // Initialize range value displays
            updateRangeValue('revenueAssumption', 'revenueAssumptionValue');
            updateRangeValue('rdSpendAssumption', 'rdSpendAssumptionValue');
            updateRangeValue('marketCompLevel', 'marketCompLevelValue');
            updateRangeValue('regScrutinyLevel', 'regScrutinyLevelValue');
            updateRangeValue('llmOptimism', 'llmOptimismValue');
            updateRangeValue('expertCriticality', 'expertCriticalityValue');

            // Initial population of table and chart
            recalculateAndRender(); // Includes populateTable and updateChart
            createChart(); // Create chart after first render

            // Gemini Button Integrations (Simulated)
            const expertTakeButton = document.getElementById('expertTakeOnLLMSnippetsButton');
            if (expertTakeButton) {
                expertTakeButton.addEventListener('click', () => {
                    const llmOptimism = parseInt(document.getElementById('llmOptimism').value);
                    const regScrutiny = parseInt(document.getElementById('regScrutinyLevel').value);

                    const promptGenerator = () => {
                        const snippets = generateLLMSnippets(llmOptimism).replace(/<\/?li>/g, '').replace(/<\/?strong>/g, ''); // Get raw text
                        let insights = `Based on the current LLM snippets (Optimism: ${llmOptimism}/10):\n\n`;
                        insights += `Regarding Financial Overview:\n* An expert might question the sustainability of growth if it's solely API-driven without mentioning diversification or margin improvements.\n`;
                        insights += `* They'd look for specific growth drivers beyond "enterprise solutions" – what kind, at what scale?\n`;
                        if (llmOptimism > 7) insights += `* With high optimism, an expert would probe for concrete evidence backing such positive revenue statements, especially new major contracts or technological breakthroughs leading to new revenue streams.\n`

                        insights += `\nRegarding Risk Factors:\n* "Important areas of focus" is vague. An expert would want to know *how* OpenAI is addressing these, and the C-level responsible.\n`;
                        insights += `* What are the *financial implications* of non-compliance or major societal backlash? Is there a risk reserve?\n`;
                        if (regScrutiny > 7) insights += `* Given high regulatory scrutiny (${regScrutiny}/10), an expert would expect the LLM report to detail specific regulations (e.g., EU AI Act, data sovereignty laws) and OpenAI's precise mitigation strategies, not just general statements.\n`
                        else if (regScrutiny < 4) insights += `* With lower perceived regulatory scrutiny (${regScrutiny}/10), an expert might still caution against complacency, noting the rapidly evolving nature of AI governance globally.\n`
                        return insights;
                    };
                    callSimulatedGeminiApi(promptGenerator, 'expertTakeOnLLMSnippetsResult', '✨ Fetching simulated expert perspective...');
                });
            }

            const counterargumentsButton = document.getElementById('counterargumentsToExpertViewButton');
            if (counterargumentsButton) {
                counterargumentsButton.addEventListener('click', () => {
                    const revenue = parseFloat(document.getElementById('revenueAssumption').value);
                    const rdSpend = parseFloat(document.getElementById('rdSpendAssumption').value);
                    const expertCriticality = parseInt(document.getElementById('expertCriticality').value);
                    const marketComp = parseInt(document.getElementById('marketCompLevel').value);

                    const promptGenerator = () => {
                        const expertSnippet = generateExpertFinancialAnalysis(revenue, rdSpend, expertCriticality);
                        let counterArgs = `Counterarguments to the expert view (Revenue: $${revenue}B, R&D: $${rdSpend}B, Criticality: ${expertCriticality}/10):\n\n`;
                        if (rdSpend / revenue > 1.5 && expertCriticality > 7) { // High R&D, high criticality
                            counterArgs += `* The aggressive R&D spend, while pressuring near-term profitability, could be a strategic moat, leading to foundational models years ahead of competitors. Long-term investors might value this over immediate returns.\n`;
                            counterArgs += `* "Cash burn" might be well-managed if OpenAI has secured substantial long-term funding commitments or has access to low-cost capital from strategic partners.\n`;
                        } else {
                            counterArgs += `* The focus on COGS and compute costs might overlook significant efficiency gains from custom hardware (if any) or algorithmic breakthroughs that drastically reduce inference costs over time.\n`;
                        }
                        if (marketComp < 5) {
                             counterArgs += `* If market competition is perceived as lower (${marketComp}/10), the pressure to achieve immediate high margins might be less intense, allowing for more strategic pricing to capture market share.\n`;
                        } else {
                             counterArgs += `* New, unforeseen high-margin applications of OpenAI's core technology could emerge, rapidly altering the margin profile (e.g., specialized AI for drug discovery, advanced robotics control).\n`;
                        }
                        counterArgs += `* The expert's view might be overly focused on traditional software company metrics, while OpenAI operates more like a capital-intensive deep-tech research firm in a winner-take-most market.\n`;
                        return counterArgs;
                    };
                    callSimulatedGeminiApi(promptGenerator, 'counterargumentsToExpertViewResult', '✨ Generating simulated counterarguments...');
                });
            }
            
            // Sidebar toggle for mobile (ensure this is present from original script)
            const sidebar = document.getElementById('sidebar');
            const mobileNavToggle = document.getElementById('mobileNavToggle');
            if (mobileNavToggle && sidebar) {
                mobileNavToggle.addEventListener('click', () => {
                    sidebar.classList.toggle('-translate-x-full');
                    sidebar.classList.toggle('translate-x-0');
                });
            }

            // Smooth scroll and active link highlighting (ensure this is present and handles new nav link)
            const links = document.querySelectorAll('#TableOfContents a');
            const sections = document.querySelectorAll('main section[id]');
            function changeLinkState() {
                let index = sections.length;
                while(--index && window.scrollY + 100 < sections[index].offsetTop) {}
                links.forEach((link) => link.classList.remove('active-nav-link'));
                if (links[index]) {
                   links[index].classList.add('active-nav-link');
                }
            }
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    if (sidebar.classList.contains('translate-x-0') && window.innerWidth < 640) {
                         sidebar.classList.add('-translate-x-full');
                         sidebar.classList.remove('translate-x-0');
                    }
                });
            });
            window.addEventListener('scroll', changeLinkState);
            changeLinkState();

        });
    </script>
</body>
</html>
